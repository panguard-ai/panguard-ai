rule Suspicious_ELF_Packer {
    meta:
        id = "yara-004"
        description = "Detects packed or obfuscated ELF binaries"
        author = "OpenClaw Security"
        date = "2026-02-25"
        severity = "high"
        mitre_attack = "T1027.002"
    strings:
        $elf_magic = { 7F 45 4C 46 }
        $upx = "UPX!" ascii
        $upx_sig = { 55 50 58 21 }
    condition:
        $elf_magic at 0 and any of ($upx, $upx_sig)
}

rule CryptoMiner_Strings {
    meta:
        id = "yara-005"
        description = "Detects cryptocurrency miner indicators"
        author = "OpenClaw Security"
        date = "2026-02-25"
        severity = "medium"
        mitre_attack = "T1496"
    strings:
        $stratum = "stratum+tcp://" ascii
        $stratum_ssl = "stratum+ssl://" ascii
        $xmrig = "xmrig" ascii nocase
        $pool1 = "pool.minexmr.com" ascii
        $pool2 = "monerohash.com" ascii
        $pool3 = "moneropool.com" ascii
        $pool4 = "xmrpool.eu" ascii
        $pool5 = "nanopool.org" ascii
        $wallet_pattern = /[48][0-9AB][1-9A-HJ-NP-Za-km-z]{93}/
    condition:
        any of ($stratum, $stratum_ssl) or
        any of ($xmrig) or
        2 of ($pool1, $pool2, $pool3, $pool4, $pool5) or
        $wallet_pattern
}

rule Ransomware_Note {
    meta:
        id = "yara-006"
        description = "Detects ransomware ransom note indicators"
        author = "OpenClaw Security"
        date = "2026-02-25"
        severity = "critical"
        mitre_attack = "T1486"
    strings:
        $s1 = "your files have been encrypted" ascii nocase
        $s2 = "bitcoin" ascii nocase
        $s3 = "decrypt" ascii nocase
        $s4 = "ransom" ascii nocase
        $s5 = "payment" ascii nocase
        $s6 = "tor browser" ascii nocase
        $s7 = ".onion" ascii
        $btc_addr = /[13][a-km-zA-HJ-NP-Z1-9]{25,34}/
    condition:
        3 of ($s1, $s2, $s3, $s4, $s5, $s6, $s7) or
        ($btc_addr and 2 of ($s1, $s2, $s3, $s4, $s5))
}

rule Reverse_Shell_Binary {
    meta:
        id = "yara-007"
        description = "Detects compiled reverse shell binaries"
        author = "OpenClaw Security"
        date = "2026-02-25"
        severity = "critical"
        mitre_attack = "T1059"
    strings:
        $sock = "socket" ascii
        $connect = "connect" ascii
        $dup2 = "dup2" ascii
        $execve = "execve" ascii
        $bin_sh = "/bin/sh" ascii
        $bin_bash = "/bin/bash" ascii
    condition:
        uint32(0) == 0x464C457F and
        $sock and $connect and $dup2 and
        ($execve or $bin_sh or $bin_bash)
}
